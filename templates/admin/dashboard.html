{% extends "base.html" %}
{% block title %}Admin - Tableau de bord{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  .main-content {
    position: fixed;
    top: 56px;
    left: 250px;
    right: 0;
    bottom: 50px;
    overflow-y: auto;
    background-color: #f9fafb;
    padding: 30px;
  }

  .card-stats {
    border-radius: 12px;
    padding: 20px;
    color: #fff;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  }

  .card-orange { background: linear-gradient(to right, #ff6a00, #ee0979); }
  .card-blue { background: linear-gradient(to right, #0072ff, #00c6ff); }
  .card-green { background: linear-gradient(to right, #00b09b, #96c93d); }
  .card-purple { background: linear-gradient(to right, #8e2de2, #4a00e0); }

  .chart-card {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    margin-top: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
  }
</style>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 sidebar-light">
      <h5 class="text-center text-primary fw-bold mb-4">‚öôÔ∏è Admin Panel</h5>
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link active" href="/admin"><i class="bi bi-bar-chart"></i> Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/users"><i class="bi bi-people"></i> Utilisateurs</a></li>
        <li class="nav-item"><a class="nav-link" href="/"><i class="bi bi-chat-left-text"></i> Chat</a></li>
      </ul>
    </nav>

    <!-- Main -->
    <main class="col-md-9 main-content">
      <div class="row g-4">
        <div class="col-md-3">
          <div class="card card-stats card-orange">
            <h6>Total Messages</h6>
            <h3>{{ total_messages }}</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stats card-blue">
            <h6>Utilisateurs</h6>
            <h3>{{ total_users }}</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stats card-green">
            <h6>Clients</h6>
            <h3>{{ total_clients }}</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stats card-purple">
            <h6>Robots</h6>
            <h3>{{ total_robots }}</h3>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="chart-card">
            <h6>üìÖ Messages par mois</h6>
            <canvas id="barChart"></canvas>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-card">
            <h6>üìä R√©partition par domaine</h6>
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
  new Chart(document.getElementById("barChart"), {
    type: 'bar',
    data: {
      labels: {{ months | tojson }},
      datasets: [{
        label: 'Messages',
        data: {{ monthly_counts | tojson }},
        backgroundColor: '#6366f1'
      }]
    }
  });

  new Chart(document.getElementById("pieChart"), {
    type: 'doughnut',
    data: {
      labels: {{ domains | tojson }},
      datasets: [{
        data: {{ domain_counts | tojson }},
        backgroundColor: ['#ef4444', '#10b981', '#3b82f6', '#f59e0b', '#8b5cf6']
      }]
    }
  });
</script>
{% endblock %}
