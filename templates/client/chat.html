{% extends "base.html" %}
{% block title %}Bosseurs-Chat{% endblock %}

{% block content %}
<style>
  html, body {
    height: 100vh;
    overflow: hidden;
  }

  .container-fluid, .row {
    height: 100%;
    margin: 0;
  }

  .sidebar {
    background-color: #ffffff;
    border-right: 1px solid #e5e7eb;
    height: 100%;
    padding: 20px;
    position: fixed;
    top: 56px;
    left: 0;
    width: 250px;
    overflow-y: auto;
  }

  .sidebar .nav-link {
    color: #374151;
    font-size: 0.95rem;
    padding: 10px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
    text-decoration: none;
    font-weight: 500;
  }

  .sidebar .nav-link:hover,
  .sidebar .nav-link.active {
    background-color: #f3f4f6;
    color: #4f46e5;
  }

  .main-content {
    position: fixed;
    top: 56px;
    left: 250px;
    right: 0;
    bottom: 50px;
    display: flex;
    flex-direction: column;
    background-color: #f9faf0;
    padding: 20px;
  }

  .chat-box {
    background-color: #e5fff1;
    border-radius: 12px;
    padding: 20px;
    flex-grow: 1;
    overflow-y: auto;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }

  .bubble {
    padding: 10px 14px;
    border-radius: 10px;
    margin-bottom: 10px;
    max-width: 75%;
    word-wrap: break-word;
    font-size: 0.9rem;
  }

  .client .bubble {
    background-color: #4f46e5;
    color: #ffffff;
    margin-left: auto;
  }

  .robot .bubble {
    background-color: #e5e7eb;
    color: #111827;
    margin-right: auto;
  }

  .chat-input {
    background-color: #f9fafb;
    padding-top: 15px;
    border-top: 1px solid #e5e7eb;
  }

  .chat-input input {
    background-color: #ffffff;
    color: #111827;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    flex-grow: 1;
    padding: 10px 15px;
  }

  .chat-input input::placeholder {
    color: #9ca3af;
  }

  .chat-input button {
    background-color: #4f46e5;
    color: #ffffff;
    border: none;
    border-radius: 8px;
  }

  @media (max-width: 768px) {
    .sidebar {
      position: relative;
      width: 100%;
      height: auto;
      top: 0;
      border-right: none;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      overflow-x: auto;
      padding: 10px;
      gap: 10px;
    }

    .main-content {
      position: relative;
      margin-left: 0;
      margin-top: 0;
      height: auto;
      padding: 10px;
    }
  }
</style>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 sidebar">
      <a href="/" class="nav-link active"><i class="bi bi-chat-dots"></i> Chat</a>
      <a href="#" class="nav-link"><i class="bi bi-book"></i> Enseignement</a>
      <a href="#" class="nav-link"><i class="bi bi-heart-pulse"></i> Consultation</a>
      <a href="#" class="nav-link"><i class="bi bi-gear"></i> Installation</a>
      <a href="#" class="nav-link"><i class="bi bi-tools"></i> Entretien</a>
      <a href="#" class="nav-link"><i class="bi bi-cart"></i> Achats</a>
    </nav>

    <!-- Main Content -->
    <main class="col-md-9 main-content">
      <h5 class="mb-3">ðŸ’¬ Espace de Discussion</h5>

      <div class="chat-box" id="chatBox">
        {% for msg in messages[-20:] %}
        <div class="d-flex {{ msg.sender }}">
          <div class="bubble {{ msg.sender }}">
            <strong>{{ msg.sender.capitalize() }}:</strong> {{ msg.content }}
          </div>
        </div>
        {% endfor %}
      </div>

      <form method="POST" class="chat-input d-flex gap-2 mt-2">
        <input type="text" name="message" class="form-control" placeholder="Tapez votre message..." required autocomplete="off">
        <button type="submit" class="btn"><i class="bi bi-send-fill"></i></button>
      </form>
    </main>
  </div>
</div>

<script>
  const chatBox = document.getElementById('chatBox');
  if (chatBox) {
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
{% endblock %}
